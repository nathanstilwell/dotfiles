#!/usr/bin/env bash

function stage_usage {
  cat <<HELP

  usage: stage <command>

   command
       update-sales         rake data_quality:update
       clean-the-zoo        /opt/gilt/zookeeper/bin/zkCleanup.sh -n 5
       kill-rsync-folders   rm -rf /web/rsync/*
HELP
}

function update_sales {
  cd /web/util-data-quality;
  rake data_quality:update;
  cd -;
}

function clean_the_zoo {
  default=5;
  /opt/gilt/zookeeper/bin/zkCleanup.sh -n ${5-default};
}

function kill_rsync_folders {
  cd /web/rsync;
  rm -rf ./
}

function deploy {
  app=$1
  override=${2-"origin/master"}
  if [ -z $app ]; then
cat <<USAGE
    usage: stage deploy <app> <override>
USAGE
    return;
  fi

  sudo rm -rf /tmp/Less-lint/;
  cd /setup;
  rake $app[$override];
  cd -;
}

function stage {
  action=$1;
  if [ -z $action ]; then
    stage_usage;
    return;
 fi

  [ "update-sales" = $action ] && update_sales;
  [ "clean-the-zoo" = $action ] && clean_the_zoo;
  [ "kill-rsync-folders" = $action ] && kill_rsync_folders;
}
